<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <![endif]-->
<!--[if IE 7]>         <html lang="en" class="no-js lt-ie9 lt-ie8" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <![endif]-->
<!--[if IE 8]>         <html lang="en" class="no-js lt-ie9" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" class="no-js" prefix="og: http://ogp.me/ns#" itemscope itemtype="http://schema.org/BlogPosting"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Introduction to Communicating Sequential Processes in JavaScript</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="The JavaScript programming language features a rich set of techniques for dealing with asynchronous computation. Raw Continuation Passing Style (CPS) with callbacks, promises and Functional Reactive Programming are commonplace in today's JS. EcmaScript 7 will bring syntantic sugar on top of promises with async and await and you can ...">
<link rel="shortcut icon" href="http://dialelo.github.io/favicon.ico" type="image/png">
<meta name="author" content="Alejandro Gómez">
<meta name="copyright" content="Alejandro Gómez">
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@dialelo" />
<meta property="og:site_name" content="dialelo" />

<meta property="og:title" content="Introduction to communicating sequential processes in javascript" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://dialelo.github.io/drafts/introduction-to-communicating-sequential-processes-in-javascript.html" />
<meta name="twitter:title" content="Introduction to communicating sequential processes in javascript" />
<meta name="twitter:url" content="http://dialelo.github.io/drafts/introduction-to-communicating-sequential-processes-in-javascript.html" />
<meta itemprop="url" content="http://dialelo.github.io/drafts/introduction-to-communicating-sequential-processes-in-javascript.html" />
<meta property="og:description" content="The JavaScript programming language features a rich set of techniques for dealing with asynchronous computation. Raw Continuation Passing Style (CPS) with callbacks, promises and Functional Reactive Programming are commonplace in today&#39;s JS. EcmaScript 7 will bring syntantic sugar on top of promises with async and await and you can ..." />
<meta name="twitter:description" content="The JavaScript programming language features a rich set of techniques for dealing with asynchronous computation. Raw Continuation Passing Style (CPS) with callbacks, promises and Functional Reactive Programming are commonplace in today&#39;s JS. EcmaScript 7 will bring syntantic sugar on top of promises with async and await and you can ..." />
<meta property="og:article:published_time" content="2015-03-16" />
<meta property="og:article:author" content="Alejandro Gómez" >

<link href="http://dialelo.github.io/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="dialelo ATOM Feed"/>
<link href='//fonts.googleapis.com/css?family=Open+Sans:800italic' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/uikit/2.15.0/css/uikit.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/uikit/2.15.0/css/components/search.min.css">
<link rel="stylesheet" href="/theme/css/tipuesearch.css">
<link rel="stylesheet" href="/theme/css/solarized.css">
<link rel="stylesheet" href="/theme/css/main.css">

<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
</head>
<body>
<!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

<header class=" mg-header uk-navbar uk-navbar-attached">

    <div class="uk-container uk-container-center">
        <div class="uk-grid" data-uk-grid-margin>

            <a class="mg-brand uk-navbar-brand uk-hidden-small" href="http://dialelo.github.io">dialelo</a>
            <div class="mg-tagline uk-navbar-content uk-hidden-small"></div>
            <a class="uk-navbar-toggle uk-visible-small" href="#mg-offcanvas" data-uk-offcanvas></a>
            <a class="mg-brand uk-navbar-brand uk-navbar-center uk-visible-small" href="http://dialelo.github.io">dialelo</a>

        </div>
    </div>
</header>

<main class="mg-main">

<div class="uk-container uk-container-center">

    <div class="uk-grid" data-uk-grid-margin>

<div class="mg-container-social uk-width-medium-1-10 uk-hidden-small">

    <div class="uk-panel" id="mg-panel-social">
        <ul class="uk-nav uk-nav-side">
            <li>
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://dialelo.github.io/drafts/introduction-to-communicating-sequential-processes-in-javascript.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;" taget="_blank" class="uk-button"><i class="uk-icon-facebook-square"></i> Share</a>
            </li>
            <li>
            <a href="https://twitter.com/intent/tweet?text=Introduction%20to%20Communicating%20Sequential%20Processes%20in%20JavaScript&url=http://dialelo.github.io/drafts/introduction-to-communicating-sequential-processes-in-javascript.html&via=dialelo" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" class="uk-button" target="_blank"><i class="uk-icon-twitter"></i> Tweet</a>
            </li>
            <li>
            <a href="https://plus.google.com/share?url=http://dialelo.github.io/drafts/introduction-to-communicating-sequential-processes-in-javascript.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank" class="uk-button"><i class="uk-icon-google-plus-square"></i> Share</a>
            </li>
        </ul>
    </div>

</div>

<div class="uk-width-medium-7-10">

    <article class="uk-article">
        <h1 class="uk-heading-large uk-article-title" itemprop="name">Introduction to Communicating Sequential Processes in JavaScript</h1>
        <p class="uk-article-meta"><time datetime="2015-03-16" itemprop="datePublished">Mon 16 March 2015</time> in <a href="http://dialelo.github.io/category/javascript.html">JavaScript</a></p>

        <a href="https://www.facebook.com/sharer/sharer.php?u=http://dialelo.github.io/drafts/introduction-to-communicating-sequential-processes-in-javascript.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;" taget="_blank" class="uk-button uk-visible-small"><i class="uk-icon-facebook-square"></i> Share</a>
        <a href="https://twitter.com/intent/tweet?text=Introduction%20to%20Communicating%20Sequential%20Processes%20in%20JavaScript&url=http://dialelo.github.io/drafts/introduction-to-communicating-sequential-processes-in-javascript.html&via=dialelo" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" class="uk-button uk-visible-small" target="_blank"><i class="uk-icon-twitter"></i> Tweet</a>
        <a href="https://plus.google.com/share?url=http://dialelo.github.io/drafts/introduction-to-communicating-sequential-processes-in-javascript.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" target="_blank" class="uk-button uk-visible-small"><i class="uk-icon-google-plus-square"></i> Share</a>

        <section itemprop="articleBody"><p>The JavaScript programming language features a rich set of techniques
for dealing with asynchronous computation. Raw <a href="http://en.wikipedia.org/wiki/Continuation-passing_style">Continuation Passing Style (CPS) </a>
with callbacks, <a href="http://en.wikipedia.org/wiki/Futures_and_promises">promises</a> and
<a href="http://en.wikipedia.org/wiki/Functional_reactive_programming">Functional Reactive Programming</a> are commonplace in today's JS.
EcmaScript 7 will bring syntantic sugar on top of promises with <code>async</code> and <code>await</code> and you can use that today with
<a href="http://babeljs.io/">Babel</a>.</p>
<p>However, the <a href="https://golang.org/">Go</a> and <a href="https://github.com/clojure/clojurescript">Clojure(Script)</a> programming languages
have popularized modern incarnations of <a href="http://es.wikipedia.org/wiki/C._A._R._Hoare">Tony Hoare's</a>
<a href="http://en.wikipedia.org/wiki/Communicating_sequential_processes">Communicating Sequential Processes (CSP)</a>, which is a great substrate for representing
async computations and is backed by mathematical formalism. This article is intended as an introduction to CSP using the <a href="https://github.com/ubolonton/js-csp">js-csp</a>
library, which is a straight port of the fantastic Clojure(Script) <a href="https://github.com/">core.async</a>. We'll
explore the aforementioned alternatives and talk about their strengths and weaknesses. After that we'll
delve into the building blocks of CSP: channels and processes; and show some examples of what you can do with such
primitives.</p>
<h2>Continuation Passing Style</h2>
<p>The most common way of doing asynchronous computation in JavaScript has traditionally been continuation passing
style, using callbacks for continuing async calls. This approach is prevalent in many of the APIs we use as JavaScript
programmers, we can find examples in the browser, node, and many existing libraries. The error handling is done either
accepting an error argument in the continuation or providing <strong>two</strong> continuations, one for succesful results and another for errors.</p>
<p>For a contrived example, let's assume that we have to make two calls to asynchronous functions, one called <code>getUserToken</code>
for getting a authentication token and another to <code>getUserInfo</code> that needs to be authenticated with the token, we then log
the user avatar URL to the console. Both functions accept success and error continuation as the last two arguments.</p>
<div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span><span class="nx">getUserToken</span><span class="p">,</span> <span class="nx">getUserInfo</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;./user-cps&quot;</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">username</span> <span class="o">=</span> <span class="s2">&quot;Ada Byron&quot;</span><span class="p">,</span>
    <span class="nx">password</span> <span class="o">=</span> <span class="s2">&quot;I invented programming&quot;</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">onError</span> <span class="o">=</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>

<span class="nx">getUserToken</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">getUserInfo</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="p">(</span><span class="nx">userInfo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">userInfo</span><span class="p">[</span><span class="s1">&#39;avatar&#39;</span><span class="p">]);</span>
    <span class="p">},</span> <span class="nx">onError</span><span class="p">);</span>
<span class="p">},</span> <span class="nx">onError</span><span class="p">);</span>
</pre></div>


<p>Althoug our logic is very simple the callback machinery obscures it and the effort required to understand what's
going on is a lot more than it should be. Continuation passing style is very low-level and I think that most people will
agree that we need better abstractions on top of that. Luckily it's easy to transform functions written in continuation
passing style to offer a nicer inteface.</p>
<h2>Promises</h2>
<p>Promises have slightly improved on CPS offering a first-class notion of asynchronous computations that may fail. There are
many promise libraries available and since it has become so widespread ES6 is shipping them as part of the standard. If our
<code>getUserToken</code> and <code>getUserInfo</code> function returned promises, we could transform the above example to this:</p>
<div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span><span class="nx">getUserToken</span><span class="p">,</span> <span class="nx">getUserInfo</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;./user-promises&quot;</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">username</span> <span class="o">=</span> <span class="s2">&quot;Ada Byron&quot;</span><span class="p">,</span>
    <span class="nx">password</span> <span class="o">=</span> <span class="s2">&quot;I invented programming&quot;</span><span class="p">;</span>

<span class="nx">getUserToken</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">)</span>
   <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">token</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">getUserInfo</span><span class="p">(</span><span class="nx">token</span><span class="p">))</span>
   <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">userInfo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">userInfo</span><span class="p">[</span><span class="s1">&#39;avatar&#39;</span><span class="p">]);</span>
    <span class="p">})</span>
   <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>
</pre></div>


<p>Promises obscure our logic too since we have to scatter a logical piece of functionality in multiple unrelated small functions.
On top of that, the <code>then</code> method <a href="http://en.wiktionary.org/wiki/complect">complects</a> <code>map</code>ping a transforming function over the
value contained in a Promise with sequencing (<code>flatMap</code>) computations that return promises.</p>
<h3>async/await</h3>
<p>ES7's <code>async</code> and <code>await</code> keywords let us express asynchronous computations using promises in a much more clear way, solving the
problem of obscured logic I talked before. We can declare a function as <code>async</code> and "block" for promises using the <code>await</code> keyword:</p>
<div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span><span class="nx">getUserToken</span><span class="p">,</span> <span class="nx">getUserInfo</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;./user-promises&quot;</span><span class="p">;</span>

<span class="nx">async</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">username</span> <span class="o">=</span> <span class="s2">&quot;Ada Byron&quot;</span><span class="p">,</span>
        <span class="nx">password</span> <span class="o">=</span> <span class="s2">&quot;I invented programming&quot;</span><span class="p">;</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getUserToken</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">);</span>
        <span class="kd">let</span> <span class="nx">userInfo</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">getUserInfo</span><span class="p">(</span><span class="nx">token</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">userInfo</span><span class="p">[</span><span class="s1">&#39;avatar&#39;</span><span class="p">]);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>In my opinion this is much more clear and, as mentioned before, we can use it today with translators such as <a href="http://babeljs.io/">Babel</a>.</p>
<h2>Reactive streams</h2>
<p>This is an unfair comparison since reactive streams represent a continuum of observable values instead of an
asynchronous computation with a single value like promises. Streams are a great abstraction and you can manipulate
them using a myriad of combinators, I recommend you to take a look at them. I'll be using Bacon.js for converting
our CPS functions into streams:</p>
<div class="highlight"><pre><span class="kr">import</span> <span class="nx">Bacon</span> <span class="nx">from</span> <span class="s2">&quot;baconjs&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">getUserToken</span><span class="p">,</span> <span class="nx">getUserInfo</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;./user-cps&quot;</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">username</span> <span class="o">=</span> <span class="s2">&quot;Ada Byron&quot;</span><span class="p">,</span>
    <span class="nx">password</span> <span class="o">=</span> <span class="s2">&quot;I invented programming&quot;</span><span class="p">;</span>

<span class="nx">Bacon</span><span class="p">.</span><span class="nx">fromCallback</span><span class="p">(</span><span class="nx">getUserToken</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">)</span>
     <span class="p">.</span><span class="nx">flatMap</span><span class="p">((</span><span class="nx">token</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Bacon</span><span class="p">.</span><span class="nx">fromCallback</span><span class="p">(</span><span class="nx">getUserInfo</span><span class="p">,</span> <span class="nx">token</span><span class="p">))</span>
     <span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">userInfo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">userInfo</span><span class="p">[</span><span class="s1">&#39;avatar&#39;</span><span class="p">])</span>
     <span class="p">.</span><span class="nx">log</span><span class="p">()</span>
     <span class="p">.</span><span class="nx">onError</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>
</pre></div>


<p>Streams still scatter our logic but they separate value transformation (<code>map</code>) from sequencing (<code>flatMap</code>), although
it may depend on the implementation you are using.</p>
<h2>CSP</h2>
<p>I'll go into detail about CSP below but before that let's revisit our example. <code>async</code> and <code>await</code> are designed with
promises in mind but we can get a similar syntactic abstraction using generators. Now our <code>getUserToken</code> and <code>getUserInfo</code>
functions will return channels, and they will put the value computed asynchronously in the channels they return:</p>
<div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span><span class="nx">go</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;js-csp&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">getUserToken</span><span class="p">,</span> <span class="nx">getUserInfo</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;./user-csp&quot;</span><span class="p">;</span>


<span class="nx">go</span><span class="p">(</span><span class="kd">function</span><span class="o">*</span><span class="p">(){</span>
    <span class="kd">let</span> <span class="nx">username</span> <span class="o">=</span> <span class="s2">&quot;Ada Byron&quot;</span><span class="p">,</span>
        <span class="nx">password</span> <span class="o">=</span> <span class="s2">&quot;I invented programming&quot;</span><span class="p">;</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">getUserToken</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">);</span>
        <span class="kd">let</span> <span class="nx">userInfo</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">getUserInfo</span><span class="p">(</span><span class="nx">token</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">userInfo</span><span class="p">[</span><span class="s1">&#39;avatar&#39;</span><span class="p">]);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>


<p>As you can see, it's fairly similar to the example of promises with <code>async</code> and <code>await</code>. Let's dive into
the abstractions that CSP gives us for asynchronous computation to understand the above example better.</p>
<h2>Channels</h2>
<p>Channels are first-class queue-like objects, multiple readers and writers can either take or put one value at
a time on them. Their responsability is twofold: conveyance of values and synchronization. They decouple producers
of values from consumers and are the message-passing primitive of CSP. Channels are unbuffered by default but we can
create channels with different buffers, each with its own synchronization semantics.</p>
<p>Let's explore channels and their operations:</p>
<div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span><span class="nx">chan</span><span class="p">,</span> <span class="nx">putAsync</span><span class="p">,</span> <span class="nx">takeAsync</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;js-csp&quot;</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">ch</span> <span class="o">=</span> <span class="nx">chan</span><span class="p">();</span>

<span class="nx">takeAsync</span><span class="p">(</span><span class="nx">ch</span><span class="p">,</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Got &quot;</span><span class="p">,</span> <span class="nx">value</span><span class="p">));</span>

<span class="c1">// `ch` now has a pending take, let&#39;s try putting a value in it</span>
<span class="nx">putAsync</span><span class="p">(</span><span class="nx">ch</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
<span class="c1">//=&gt; &quot;Got 42&quot;</span>
</pre></div>


<p>Puts and takes can happen in any order:</p>
<div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span><span class="nx">chan</span><span class="p">,</span> <span class="nx">putAsync</span><span class="p">,</span> <span class="nx">takeAsync</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;js-csp&quot;</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">ch</span> <span class="o">=</span> <span class="nx">csp</span><span class="p">.</span><span class="nx">chan</span><span class="p">();</span>

<span class="c1">// Async puts accept a callback too</span>
<span class="nx">putAsync</span><span class="p">(</span><span class="nx">ch</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Just put 42&quot;</span><span class="p">));</span>
<span class="nx">putAsync</span><span class="p">(</span><span class="nx">ch</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;One more&quot;</span><span class="p">));</span>

<span class="nx">takeAsync</span><span class="p">(</span><span class="nx">ch</span><span class="p">,</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Got &quot;</span><span class="p">,</span> <span class="nx">value</span><span class="p">))</span>
<span class="c1">//=&gt; &quot;Got 42&quot;</span>
<span class="c1">//=&gt; &quot;Just put 42&quot;</span>
<span class="nx">takeAsync</span><span class="p">(</span><span class="nx">ch</span><span class="p">,</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Got &quot;</span><span class="p">,</span> <span class="nx">value</span><span class="p">))</span>
<span class="c1">//=&gt; &quot;Got 43&quot;</span>
<span class="c1">//=&gt; &quot;One more&quot;</span>
</pre></div>


<p>Channels can be closed and after closing them the pending puts will fail, whereas pending takes will receive a special value
which signals that the channel is closed. Currently in js-csp such value is <code>null</code> so it's not allowed to put <code>null</code>
into a channel.</p>
<div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span><span class="nx">chan</span><span class="p">,</span> <span class="nx">takeAsync</span><span class="p">,</span> <span class="nx">putAsync</span><span class="p">,</span> <span class="nx">CLOSED</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;js-csp&quot;</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">ch</span> <span class="o">=</span> <span class="nx">chan</span><span class="p">();</span>

<span class="nx">takeAsync</span><span class="p">(</span><span class="nx">ch</span><span class="p">,</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Channel closed? &quot;</span><span class="p">,</span> <span class="nx">value</span> <span class="o">===</span> <span class="nx">CLOSED</span><span class="p">));</span>

<span class="nx">putAsync</span><span class="p">(</span><span class="nx">ch</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
<span class="c1">//=&gt; &quot;Channel closed? false&quot;</span>

<span class="nx">takeAsync</span><span class="p">(</span><span class="nx">ch</span><span class="p">,</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Channel closed? &quot;</span><span class="p">,</span> <span class="nx">value</span> <span class="o">===</span> <span class="nx">CLOSED</span><span class="p">));</span>
<span class="nx">takeAsync</span><span class="p">(</span><span class="nx">ch</span><span class="p">,</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Channel closed? &quot;</span><span class="p">,</span> <span class="nx">value</span> <span class="o">===</span> <span class="nx">CLOSED</span><span class="p">));</span>

<span class="nx">ch</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="c1">//=&gt; &quot;Channel closed? true&quot;</span>
<span class="c1">//=&gt; &quot;Channel closed? true&quot;</span>
</pre></div>


<h2>Processes</h2>
<p>The generator that we gave to the <code>go</code> function in the example above is a <strong>process</strong>, a piece of logic that uses
channels for communication and synchronization. Puts and takes on a process will "block" until the operation
completes, that's why we have to use <code>yield</code> when calling them. If we <code>yield</code> a channel an implicit take is performed.</p>
<div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span><span class="nx">go</span><span class="p">,</span> <span class="nx">chan</span><span class="p">,</span> <span class="nx">put</span><span class="p">,</span> <span class="nx">take</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;js-csp&quot;</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">ch</span> <span class="o">=</span> <span class="nx">chan</span><span class="p">();</span>

<span class="nx">go</span><span class="p">(</span><span class="kd">function</span><span class="o">*</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[a] Starting a goroutine&quot;</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">value</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">take</span><span class="p">(</span><span class="nx">ch</span><span class="p">);</span> <span class="c1">// equivalent to &#39;yield ch&#39;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[a] Got &quot;</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">go</span><span class="p">(</span><span class="kd">function</span><span class="o">*</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[b] Starting another goroutine&quot;</span><span class="p">);</span>
    <span class="k">yield</span> <span class="nx">put</span><span class="p">(</span><span class="nx">ch</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">//=&gt; &quot;[a] Starting a goroutine&quot;</span>
<span class="c1">//=&gt; &quot;[b] Starting another goroutine&quot;</span>
<span class="c1">//=&gt; &quot;[a] Got 42&quot;</span>
</pre></div>


<p>As we can see in the example above goroutines are a form of cooperative multitasking, they use channels for communication
and channel operations for context switching. We can create thousands of these lightweight processes in our programs and coordinate via channels.</p>
<h3>Choice</h3>
<p>A cool thing about channels is that, given multiple channel operations, we can perform a non-determinismic choice between those
operations. In the Go programming language such construct is called <code>select</code>, probably after POSIX's <a href="http://linux.die.net/man/2/select">select</a>
system call, and in <code>js-csp</code> is a function called <code>alts</code>. An important thing to note is that <strong>only one</strong> of the operations given to
<code>alts</code> will suceed and in case multiple operations are ready to be performed when calling it the successful operation will be
chosen pseudo-randomly by default.</p>
<p>Combined with <code>js-csp</code>'s <code>timeout</code> function, which returns a channel that won't receive any value and close after the
given amount of milliseconds, we can execute operations on a channel given they can be performed fast enough:</p>
<div class="highlight"><pre><span class="kr">import</span> <span class="p">{</span><span class="nx">chan</span><span class="p">,</span> <span class="nx">go</span><span class="p">,</span> <span class="nx">timeout</span><span class="p">,</span> <span class="nx">put</span><span class="p">,</span> <span class="nx">alts</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;js-csp&quot;</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">ch</span> <span class="o">=</span> <span class="nx">chan</span><span class="p">();</span>

<span class="nx">go</span><span class="p">(</span><span class="kd">function</span><span class="o">*</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[a] Gonna sleep for a second&quot;</span><span class="p">);</span>
    <span class="k">yield</span> <span class="nx">timeout</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[a] Now I&#39;m ready to put a value&quot;</span><span class="p">);</span>
    <span class="k">yield</span> <span class="nx">put</span><span class="p">(</span><span class="nx">ch</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">go</span><span class="p">(</span><span class="kd">function</span><span class="o">*</span><span class="p">(){</span>
    <span class="kd">let</span> <span class="nx">cancel</span> <span class="o">=</span> <span class="nx">timeout</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>

    <span class="c1">// `alts` returns an object with the channel on which the operation has been</span>
    <span class="c1">// performed and its result</span>
    <span class="kd">let</span> <span class="p">{</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">result</span><span class="p">}</span> <span class="o">=</span> <span class="k">yield</span> <span class="nx">alts</span><span class="p">([</span><span class="nx">ch</span><span class="p">,</span> <span class="nx">cancel</span><span class="p">]);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">channel</span> <span class="o">===</span> <span class="nx">cancel</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[b] Too slow, take was cancelled&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[b] Got &quot;</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">//=&gt; &quot;[a] Gonna sleep for a second&quot;</span>
<span class="c1">//=&gt; &quot;[a] Now I&#39;m ready to put a value&quot;</span>
<span class="c1">//=&gt; &quot;[b] Too slow, take was cancelled&quot;</span>
</pre></div>


<h2>Conclusion</h2>
<p>We barely scratched the surface of what you can do with CSP in this article but I hope this introduction has served to
get you excited about it. I plan to write more on the topic, there are many things that I didn't cover for the sake of
brevity. I'm not claiming that CSP is superior to promises or reactive streams or that you should prefer it over them,
it's about knowing the abstractions you can use for expressing asynchronous computations and choosing the one that fits
the problem better and yields a simpler solution.</p>
<p>In future articles I plan to cover more topics related to CSP in JavaScript, which will include:</p>
<ul>
<li>Buffering strategies</li>
<li>Using transducers with channels</li>
<li>High-level patterns on top of CSP</li>
<li>UI component decoupling with channels</li>
<li>CSP-flavored Functional Reactive Programming</li>
</ul>
<h2>Further reading</h2>
<ul>
<li><a href="http://pouchdb.com/2015/03/05/taming-the-async-beast-with-es7.html">Taming the Async beast with ES7</a></li>
<li><a href="http://jlongster.com/Taming-the-Asynchronous-Beast-with-CSP-in-JavaScript">Taming the Async beast with CSP in JavaScript</a></li>
<li><a href="http://swannodette.github.io/2013/08/23/make-no-promises/">Make no promises</a></li>
<li><a href="http://swannodette.github.io/2013/08/24/es6-generators-and-csp/">ES6 generators and CSP</a></li>
</ul></section>
        <hr class="uk-article-divider">
    </article>


</div>

        <div class="uk-width-medium-1-5 uk-hidden-small">

            <div class="uk-panel uk-panel-box">
                <form class="uk-search" action="search.html" data-uk-search>
                    <input class="uk-search-field tipue_search" type="search" name="q" id="tipue_search_input" autocomplete="off" placeholder="Search...">
                </form>
            </div>

            <div class="uk-panel uk-panel-box">
                <ul class="uk-nav uk-nav-side">
                    <li class="uk-nav-header">Categories</li>
                    <li class="uk-active"><a href="http://dialelo.github.io/category/javascript.html">JavaScript</a></li>

                    <li class="uk-nav-divider"></li>
                    <li ><a href="http://dialelo.github.io/archives.html">Archives</a></li>
                </ul>
            </div>

            <div class="uk-panel uk-panel-box">
                <h3 class="uk-panel-title">Receive Updates</h3>
                <a rel="alternate" type="application/atom+xml" href="http://dialelo.github.io/feeds/atom.xml" class="mg-feed"><i class="uk-icon-rss uk-icon-medium"></i> ATOM</a>
            </div>

            <div class="uk-panel uk-panel-box">
                <h3 class="uk-panel-title">Contacts</h3>
                <a class="mg-icon-link" href="https://github.com/dialelo">
                    <i class="uk-icon-github uk-icon-medium"></i>
                </a>
                <a class="mg-icon-link" href="https://twitter.com/dialelo">
                    <i class="uk-icon-twitter uk-icon-medium"></i>
                </a>
            </div>

        </div>

    </div>

</div>

</main>

<footer class="mg-footer">
    <div class="uk-container uk-container-center uk-text-center">

        <div class="mg-icons-small uk-subnav uk-visible-small">
            <li><a rel="alternate" type="application/atom+xml" href="http://dialelo.github.io/feeds/atom.xml" class="uk-icon-button uk-icon-rss"></a></li>
            <li>
                <a href="https://github.com/dialelo" class="uk-icon-button uk-icon-github"></a>
            </li>
            <li>
                <a href="https://twitter.com/dialelo" class="uk-icon-button uk-icon-twitter"></a>
            </li>
        </div>

        <div class="mg-author uk-panel">
            <p>
(ɔ) 2015 Alejandro Gómez. All the content licensed under a
<a href="http://creativecommons.org/licenses/by/4.0/">
Creative Commons Attribution</a> license.<br>
Code snippets in the pages are released under
<a href="http://opensource.org/licenses/BSD-2-clause" target="_blank">
 The simplified BSD License</a>, unless otherwise specified.
</p>

            <p>Powered by <a href="http://blog.getpelican.com">Pelican</a>.<br class="uk-visible-small"> Theme based on <a href="https://github.com/lucachr/pelican-mg">mg</a> by <a href="https://github.com/lucachr">Luca Chiricozzi</a>. Favicon by <a href="http://www.defaulticon.com" >Default Icon</a>.</p>
        </div>
    </div>
</footer>

<div id="mg-offcanvas" class="uk-offcanvas">
    <div class="uk-offcanvas-bar">

        <form class="uk-search" action="search.html" data-uk-search>
            <input class="uk-search-field" type="search" name="q" id="tipue_search_input" autocomplete="off" placeholder="Search...">
        </form>

        <ul class="uk-nav uk-nav-offcanvas" data-uk-nav>
            <li class="uk-nav-header">Categories</li>
            <li class="uk-active"><a href="http://dialelo.github.io/category/javascript.html">JavaScript</a></li>

            <li class="uk-nav-divider"></li>
            <li><a href="http://dialelo.github.io/">Archives</a></li>
        </ul>
    </div>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
<script src="//cdnjs.cloudflare.com/ajax/libs/uikit/2.15.0/js/uikit.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/uikit/2.15.0/js/components/search.min.js"></script>
<script src="/theme/js/jquery.sticky-kit.js"></script>
<script src="/theme/js/tipuesearch_set.js"></script>
<script src="/theme/js/tipuesearch.js"></script>
<script src="/theme/js/plugins.js"></script>
<script src="/theme/js/main.js"></script>

</body>
</html>